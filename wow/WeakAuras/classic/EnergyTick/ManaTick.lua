--release
!WA:2!vEv3UTrUvylO6KSAlkseAdwSTy7uJ2y7gTY)14Un761RK8ilL1YsDKCY(JlKOMHsdRhroGKJTuk6n6QCxb0JGUOpa6ripafdul6f9QcFrFaY1fB6HCKKLIYcKsaBYH8Co88Z3HNJILpzNKojDEXNnu4J4x8mIJ0D1xQxxUvlbw(vXgGOKoijHr33sirCz(SYE(4Sugfp2jGRpQUAlUaBZOoIxIrcCvjhtBlDVDF1x1GJdVv2oicnF4QH3k82H3j89UDyIWB1SfHseUV4h30M5X4wX7pvOj)TdqE(UifZ9fsoI02vgrvM4rZhhpIK8buB)NzaJwWkfZB4ZzT5yHiLHwRtz4G9KOntyOhCSmGtJoY4HgZO24xppDyQdmpoqGRdxpv4HKy3bQp13QR2uu2GWg5H7f3sVDSK9ILSBSOn7ortZgVjNjb(JPSBW8hptIk7ButgO44JW2OE8Ur((y8Erl(VRmcrTDz8kmcv2mN5P1mTgsaNDvwa3g)ZwzmkqcNx2xz6IeJ1rql19bFhZ)El8DjMdoBMZQvE3aUN)p1vk9fpERTUc1MLMW2YT3tY)LLY9KsBTtw1D42xYjTBdH3p6b8jlFX9c)rj39Arqt8LyQSch3I01QAfZtozOdUzqRwkJIxW8Kk5p7KWvBAhiKSoJIM0OLrcL3iW3b(FFLlnGsKn4buTeZcgeZsVSzbmYt6o7YQcsN0DqDZtnToU43yMvXytFpupm3II6Gfjc3U7QV)mKakLHMXugkktz4ZUcZJcWEmigz0Yd124aJwipbEUTTd48sikco6mGXkk22y9OlA9ugBhjcsRiPBCWbgRR1PVUwXCF56gsxmDcAZWaby66y6LPj0wEkCmi0L37Jn2zghGCVrbMtdkH6UGsS49OtbImhjpapB)iKmmdMiizLJqRWte0Icbiq7J0uukZPzw3anHF1yMA95gBmZg8qcPEtg))FLAYmCVAYwG5OyX03earS786jLjnqF7AR9hw(gJ2(aJ)0c7Qgcx2vt0LulDOTlI2g789E(CAY0LlteURpj6SAKoyG0JXs1Qn2eES57NTPVcPsEaMwtcS4S2cK9NVX7nfTUONsOqwktFHZePx0UEJdFlg1BqX7Kf9g8mNFEXiZ7uYGciTaBq4(TW5bgBVCSxnYvxPF80zAjH82zo9BQqS5sSmD8mm6ImadI0vTrutv6TyJ1Uj5ETuAJAzbai5L38DZCF4C5(ZNu82suwoR7GzzLjMR8M2ZdmDT69vHUwH6DKgw2Uy7lc3VVWh75v0rKy4nNg(PrVZk8)vNDAXA1Ru(zMw1ZBz(7pdk884OxmsDJZyqaDsvHepi8H)toCxNcVc346O6KxH6ju6rJWFt4JgdDsa3TOkGmktFPqpLbchxId3FyoO7bIUcwyQWpEGYk1VN)H9ZHKg5z8oH71i8XHFku8zNWpzu9CzQwRE1AzSQbLyu1tceHPd3k8Oe(3dPLATintvYlUUIzDD14NehgVckMI5uK3tHABWTw(vnr2x0MdvIDYPPkwSyfoC8F58dF9R)xdeyVw6cWH)cnHoCMFrAEoJkD5sCxWJJhz6D5zfnY6HOx0VjIhjMch(3(i14xw4W)ZtvJVnEHd)77T3xSYkXGYLcqV5Qol4inWuSF4pirwORizIWF4dc32FJ3oEu58pRYrzQzofpoWHvpQeR78nX91XgcfpTWTvc)dVF4QJuUwq9Qd)10fRWFV)1nzChmp7elZ)Uz9ip)5iUJrngZts8Z6Xqo)vD3pEaaXRX16P6mOqpsY4j)C9z2aMu4gH4uORlOSROUzH1233QtaiPewAAEqtbH22dBzv(4ZmdDVF2szo2SHwiQMa4Uw6li5VB4nc6o)ewwb5547h6M4ATjM1da4Q47Uzo6i)7cCNX5pc(aSd2bQvc9nij2x07Oj5)UwAUC5xgf0JVBaXz0rNUzV9oM46G)KXtJT5McuQeF70p6Arhgt6wzYl0U(3nQLS8CaHQ)3lvX(81ROZpgY1EBDxqtC2JJCWtGmncFuJbAaPG4a(GIhxO2RMtK6McRAEIzUA5TYuYm8dIpsR5f0HlS)hqAtzC8Kw(0yctoNXfnEtNabC)pNX6aDKI7aMDZDsVD6D2zOKzpXjCNuBUgXPV65JAGZAYfrCCWuRtnFQP1OwkDc6PhjrVN1vQFMqHVW)FVYp)1V(7ELM6JUbgdn8sBrANGtOk5JBeHfRfLI4)zfvPDTq24ZZ44uMkoFg8(8syhc68jukophHB7HRxv763nTSnAeJtalvhkhwOSvXVP8P1YCYq7zpDKi6NYml6f3sNXNiPWApWU3p5L)JV6)9d

-- Trigger: UNIT_POWER_FREQUENT:player,ENERGYTICK
function(a, event, unit, power)
  local flag = false
  local currMana = UnitPower('player', 0)
  if event == 'ENERGYTICK' then
    aura_env.inflight = aura_env.inflight - 1
    if currMana == UnitPowerMax('player', 0) then
      flag = true
    end
  elseif unit == 'player' then
    if power == 'MANA' and
        currMana > (aura_env.lastMana or 0) then
      flag = true
    end
  end
  if flag then
    local duration = 2
    if not a[""] then
      a[""] = {
        show = true,
        changed = true,
        duration = duration,
        expirationTime = GetTime() + duration,
        progressType = "timed"
      }
    else
      local s = a[""]
      s.changed = true
      s.duration = duration
      s.expirationTime = GetTime() + duration
      s.show = true
      aura_env.inflight = aura_env.inflight or 0
      if aura_env.inflight == 0 then
        C_Timer.After(duration, function()
          WeakAuras.ScanEvents("ENERGYTICK", true)
        end)
        aura_env.inflight = aura_env.inflight + 1
      end
    end
  end
  aura_env.lastMana = currMana
  return true
end
